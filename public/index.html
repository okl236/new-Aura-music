<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Music Player</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="artist.css">
    <link rel="stylesheet" href="startup.css">
    <link rel="stylesheet" href="search_default.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

    <!-- Startup Animation Overlay -->
    <div id="startup-overlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="menu">
                <div class="menu-item active" data-tab="home"><i class="fas fa-home"></i> 首页</div>
                <div class="menu-item" data-tab="search"><i class="fas fa-search"></i> 搜索</div>
                <div class="menu-item" data-tab="playlist"><i class="fas fa-list"></i> 歌单</div>
                <div class="menu-item" data-tab="library"><i class="fas fa-heart"></i> 喜欢</div>
                <div class="menu-item" data-tab="history"><i class="fas fa-history"></i> 历史</div>
            </div>

            <div class="user-section" id="user-section" style="margin-top: auto; padding: 10px; cursor: pointer;">
                <div class="user-info" style="display: flex; align-items: center; color: rgba(255,255,255,0.7); transition: color 0.3s;">
                    <i class="fas fa-user-circle" style="font-size: 24px; margin-right: 10px;"></i>
                    <span id="user-name-display" style="font-size: 14px;">点击登录</span>
                </div>
            </div>

            <div class="import-section">
                <input type="text" id="import-url" placeholder="输入网易云歌单链接...">
                <button id="import-btn">导入</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Search Bar (Visible in Search Tab) -->
            <div class="search-bar-container" id="search-container" style="display: none;">
                <select id="source-select">
                    <!-- Options populated by JS -->
                </select>
                <input type="text" id="search-input" placeholder="搜索歌曲、歌手...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>

            <!-- Search Default Page (History & Recommendations) -->
            <div class="search-default-container" id="search-default-container">
                <div class="search-history-section" id="search-history-section" style="display: none;">
                    <div class="search-history-header">搜索历史</div>
                    <div class="history-capsules-container" id="history-capsules-container">
                        <!-- Capsules injected here -->
                    </div>
                </div>

                <div class="search-recommend-section" id="search-recommend-section">
                    <div class="search-recommend-header">猜你喜欢</div>
                    <div class="recommend-list" id="recommend-list">
                        <!-- Recommended songs injected here -->
                    </div>
                    <div class="recommend-loading" id="recommend-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i> 正在加载推荐...
                    </div>
                    <div id="recommend-sentinel" style="height: 20px; width: 100%;"></div>
                </div>
            </div>

            <div class="content-header">
                <h1>歌曲列表</h1>
            </div>

            <div class="home-container" id="home-container">
                <div class="home-hero-row">
                    <div class="home-hero-card" id="daily-card">
                        <div class="home-hero-label">每日推荐</div>
                        <div class="home-hero-main">
                            <img id="daily-cover" class="home-hero-cover" src="https://via.placeholder.com/300" alt="每日推荐封面">
                            <div class="home-hero-text">
                                <div class="home-hero-title" id="daily-title">每日推荐</div>
                                <div class="home-hero-subtitle" id="daily-subtitle">基于你的喜欢自动生成</div>
                            </div>
                        </div>
                    </div>
                    <div class="home-hero-card" id="radar-card">
                        <div class="home-hero-label">私人雷达</div>
                        <div class="home-hero-main">
                            <img id="radar-cover" class="home-hero-cover" src="https://via.placeholder.com/300" alt="私人雷达封面">
                            <div class="home-hero-text">
                                <div class="home-hero-title" id="radar-title">私人雷达</div>
                                <div class="home-hero-subtitle" id="radar-subtitle">基于最近播放为你发现新歌</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="home-section">
                    <div class="home-section-header">
                        <h2>推荐歌单</h2>
                        <button class="refresh-btn" id="refresh-recommend-btn" title="刷新推荐"><i class="fas fa-sync-alt"></i></button>
                    </div>
                    <div class="home-playlist-grid" id="home-playlist-grid"></div>
                </div>
            </div>

            <div class="song-list-header">
                <div class="col-index">#</div>
                <div class="col-title">标题</div>
                <div class="col-artist">歌手</div>
                <div class="col-album">专辑</div>
                <div class="col-duration">时长</div>
            </div>

            <div class="song-list" id="song-list">
                <!-- Songs will be injected here -->
                <div class="loading-spinner" id="loading" style="display: none;">加载中...</div>
            </div>
            <div class="pagination-container" style="text-align: center; margin: 20px 0; display: none;" id="pagination-container">
                <button id="load-more-btn" class="load-more-btn">加载更多</button>
            </div>

            <!-- Liked Container (Visible in Library Tab) -->
            <div class="liked-container" id="liked-container" style="display: none;">
                <div class="song-list-header">
                    <div class="col-index">#</div>
                    <div class="col-title">标题</div>
                    <div class="col-artist">歌手</div>
                    <div class="col-album">专辑</div>
                    <div class="col-duration">时长</div>
                </div>
                <div class="song-list" id="liked-list">
                    <!-- Liked items injected here -->
                </div>
            </div>

            <!-- Playlist Container (Visible in Playlist Tab) -->
            <div class="playlist-container" id="playlist-container" style="display: none;">
                <div class="playlist-grid" id="my-playlist-grid">
                     <!-- Playlists injected here -->
                     <div class="create-playlist-card" id="create-playlist-card">
                        <div class="create-icon"><i class="fas fa-plus"></i></div>
                        <div class="create-text">新建歌单</div>
                     </div>
                </div>
            </div>

            <!-- Playlist Detail Container (Hidden by default) -->
            <div class="playlist-detail-container" id="playlist-detail-container" style="display: none;">
                <div class="playlist-detail-header">
                     <button class="back-to-playlists-btn" id="back-to-playlists"><i class="fas fa-arrow-left"></i></button>
                     <div class="playlist-detail-info">
                         <img id="playlist-detail-cover" src="" class="playlist-detail-cover">
                         <div class="playlist-detail-text">
                             <h2 id="playlist-detail-title">歌单标题</h2>
                             <p id="playlist-detail-desc">0首歌曲</p>
                             <div class="playlist-actions">
                                 <button class="play-all-btn" id="playlist-play-all"><i class="fas fa-play"></i> 播放全部</button>
                                 <button class="delete-playlist-btn" id="playlist-delete"><i class="fas fa-trash"></i> 删除歌单</button>
                             </div>
                         </div>
                     </div>
                </div>
                <div class="song-list-header">
                    <div class="col-index">#</div>
                    <div class="col-title">标题</div>
                    <div class="col-artist">歌手</div>
                    <div class="col-album">专辑</div>
                    <div class="col-duration">时长</div>
                    <div class="col-action" style="width: 40px;">操作</div>
                </div>
                <div class="song-list" id="playlist-detail-list">
                    <!-- Songs injected here -->
                </div>
            </div>

            <!-- History Container (Visible in History Tab) -->
            <div class="history-container" id="history-container" style="display: none;">
                <div class="history-header">
                    <button id="clear-history-btn" class="clear-btn">清空历史</button>
                </div>
                <div class="song-list-header">
                    <div class="col-index">#</div>
                    <div class="col-title">标题</div>
                    <div class="col-artist">歌手</div>
                    <div class="col-album">专辑</div>
                    <div class="col-duration">时长</div>
                    <div class="col-action" style="width: 40px;">操作</div>
                </div>
                <div class="song-list" id="history-list">
                    <!-- History items injected here -->
                </div>
            </div>

            <!-- Artist Page Container -->
            <div class="artist-page-container" id="artist-page-container" style="display: none;">
                <button class="back-btn-artist" id="back-from-artist"><i class="fas fa-arrow-left"></i></button>
                <div class="artist-header">
                    <img src="" alt="Artist" class="artist-cover-large" id="artist-page-cover">
                    <div class="artist-info">
                        <h1 class="artist-name" id="artist-page-name">Artist Name</h1>
                        <p class="artist-bio" id="artist-page-bio">Artist biography...</p>
                        <div class="artist-stats">
                        <span class="artist-stat-item" title="歌曲数量"><i class="fas fa-music"></i> <span id="artist-song-count">0</span> 歌曲</span>
                    </div>
                    </div>
                </div>
                <div class="artist-songs-section">
                    <div class="song-list-header">
                        <div class="col-index">#</div>
                        <div class="col-title">标题</div>
                        <div class="col-artist">歌手</div>
                        <div class="col-album">专辑</div>
                        <div class="col-duration">时长</div>
                    </div>
                    <div class="song-list" id="artist-song-list">
                        <!-- Artist songs injected here -->
                    </div>
                    <div class="pagination-container" id="artist-pagination-container" style="display: none; text-align: center; margin-top: 20px;">
                        <button id="artist-load-more-btn" class="load-more-btn">加载更多</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Mini Player -->
    <div class="bottom-player" id="bottom-player">
        <div class="progress-bar-mini" id="mini-progress-container">
            <div class="progress-fill-mini" id="mini-progress-fill"></div>
        </div>
        <div class="mini-content">
            <div class="mini-info" id="mini-player-info">
                <img src="https://via.placeholder.com/40" alt="Cover" id="mini-cover">
                <div class="mini-text">
                    <div class="mini-title" id="mini-title">未播放</div>
                    <div class="mini-artist" id="mini-artist">Artist</div>
                </div>
            </div>
            <div class="mini-controls">
                <button class="mini-btn" id="mini-prev"><i class="fas fa-step-backward"></i></button>
                <button class="mini-btn play-btn" id="mini-play-pause"><i class="fas fa-play"></i></button>
                <button class="mini-btn" id="mini-next"><i class="fas fa-step-forward"></i></button>
            </div>
            <div class="mini-extra">
                    <button class="add-to-playlist-btn" id="add-to-playlist-btn" title="添加到歌单"><i class="fas fa-plus"></i></button>
                    <button class="like-btn" id="mini-like-btn"><i class="far fa-heart"></i></button>
                    <div class="volume-control">
                    <button class="volume-btn" id="volume-btn"><i class="fas fa-volume-up"></i></button>
                    <div class="volume-slider-container">
                        <div class="volume-slider-fill" id="volume-fill"></div>
                        <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Unified Side Player Drawer -->
    <div class="hover-playlist-trigger" id="playlist-trigger"></div>

    <!-- Collect Playlist Modal (New Glass Style) -->
    <div class="glass-modal-overlay" id="collect-playlist-modal">
        <div class="glass-modal-content">
            <button class="glass-close-btn" id="close-collect-modal"><i class="fas fa-times"></i></button>
            <div class="glass-modal-header">
                <h3>收藏歌单</h3>
            </div>
            <div class="glass-modal-body">
                <div class="glass-input-group">
                    <label>歌单名称</label>
                    <input type="text" id="collect-playlist-name" class="glass-modal-input" placeholder="输入歌单名称...">
                </div>
                <div class="glass-input-group">
                    <label>选择歌曲</label>
                    <div class="collect-song-list" id="collect-song-list">
                        <!-- Checkbox list of songs -->
                    </div>
                </div>
                <button id="confirm-collect-playlist" class="glass-btn-primary">确认收藏</button>
            </div>
        </div>
    </div>

    <!-- Add to Playlist Modal (New Glass Style) -->
    <div class="glass-modal-overlay" id="add-to-playlist-modal">
        <div class="glass-modal-content">
            <button class="glass-close-btn" id="close-playlist-modal"><i class="fas fa-times"></i></button>
            <div class="glass-modal-header">
                <h3>添加到歌单</h3>
            </div>
            <div class="glass-modal-body">
                <div class="create-new-row" id="modal-create-playlist">
                    <div class="plus-icon"><i class="fas fa-plus"></i></div>
                    <div>新建歌单</div>
                </div>
                <div class="playlist-list-modal" id="modal-playlist-list">
                    <!-- Playlist items -->
                </div>
            </div>
        </div>
    </div>

    <!-- Create Playlist Modal (New Glass Style) -->
    <div class="glass-modal-overlay" id="create-playlist-modal">
        <div class="glass-modal-content">
            <button class="glass-close-btn" id="close-create-modal"><i class="fas fa-times"></i></button>
            <div class="glass-modal-header">
                <h3>新建歌单</h3>
            </div>
            <div class="glass-modal-body">
                <div class="glass-input-group">
                    <label>歌单名称</label>
                    <input type="text" id="new-playlist-name" class="glass-modal-input" placeholder="我的歌单">
                </div>
                <div class="glass-input-group">
                    <label>描述 (选填)</label>
                    <input type="text" id="new-playlist-desc" class="glass-modal-input" placeholder="添加描述...">
                </div>
                <button id="confirm-create-playlist" class="glass-btn-primary">创建</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Loading Modal -->
    <div class="loading-modal-overlay" id="loading-modal">
        <div class="loading-modal-content">
            <div class="loading-spinner-large"></div>
            <div class="loading-text">正在导入歌单...</div>
            <div class="loading-subtext">正在匹配音频资源</div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content">
            <h3 id="confirm-title">提示</h3>
            <p id="confirm-message">确定要执行此操作吗？</p>
            <div class="confirm-actions">
                <button class="cancel-btn" id="confirm-cancel-btn">取消</button>
                <button class="confirm-btn" id="confirm-ok-btn">确定</button>
            </div>
        </div>
    </div>

    <div class="side-player-drawer" id="side-player-drawer">
        <!-- Player Card Section -->
        <div class="drawer-player-card">
            <div class="player-header" style="display: none;">
                <button class="back-btn" id="close-drawer"><i class="fas fa-chevron-right"></i></button>
            </div>
            
            <div class="album-art-container">
                <img src="" alt="Album Art" id="player-cover">
            </div>

            <div class="track-info">
                <div class="track-name" id="player-title">Song Title</div>
                <div class="track-artist" id="player-artist">Artist Name</div>
            </div>

            <div class="waveform" id="waveform">
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
            </div>

            <div class="progress-area">
                <span id="current-time">0:00</span>
                <div class="progress-bar" id="progress-bar-container">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <span id="total-time">0:00</span>
            </div>

            <div class="control-buttons">
                <button class="ctrl-btn sm"><i class="fas fa-random"></i></button>
                <button class="ctrl-btn md" id="prev-btn"><i class="fas fa-step-backward"></i></button>
                <button class="ctrl-btn lg play-pause-btn" id="play-pause-btn"><i class="fas fa-play"></i></button>
                <button class="ctrl-btn md" id="next-btn"><i class="fas fa-step-forward"></i></button>
                <button class="ctrl-btn sm"><i class="fas fa-redo"></i></button>
            </div>
        </div>

        <!-- Playlist Section -->
        <div class="drawer-playlist-section">
            <div class="playlist-header">播放列表</div>
            <div class="playlist-items" id="immersive-playlist-items">
                <!-- Items injected via JS -->
            </div>
        </div>
    </div>

    <audio id="audio-element" style="display: none;"></audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script src="script.js"></script>
</body>
</html>
